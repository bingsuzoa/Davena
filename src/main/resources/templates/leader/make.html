<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{Layouts/default}">

	<header layout:fragment="header">
		<th:block th:replace="~{fragments/header :: .bigTitle}"></th:block>
	</header>
	
	<section layout:fragment="content" class="mt-3">
		<div class="idInputDiv">
			<input type="text" class="idInput form-control" id="roomName" placeholder="ë°© ì´ë¦„">
		</div>
		<div class="pwInputDiv">
			<input type="password" class="pwInput form-control" id="roomPw" placeholder="ë°© ë¹„ë°€ë²ˆí˜¸ğŸ”‘">
		</div>
		<div class="makeRoomBtnDiv">
			<div id="BtnMakeRoom">ë°© ë§Œë“¤ê¸°</div>
		</div>
	</section>

	
	<script layout:fragment="script">
	$(document).ready(function(){
 		
   		new Promise((succ, fail) => {
   			//ë°© ì¤‘ë³µì—¬ë¶€ í™•ì¸
			$("#BtnMakeRoom").on('click',function(){
				let roomName = $("#roomName").val();
				let roomPw = $("#roomPw").val();
				
				if(roomName == ""){
					alert("ë°© ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”.");
					return;
				}
				if(roomPw == ""){
					alert("ë°© ë¹„ë°€ë²ˆí˜¸ë¥¼ ì ì–´ì£¼ì„¸ìš”.");
					return;
				}
				$.ajax({
					type:"post"
					,url : "/room/duplicate-room"
					,data : {"roomName" : roomName, "roomPw" : roomPw}
					,success : function(data) {
						if(data.isDuplicate == false) {
							succ("ê°€ì… ê°€ëŠ¥í•œ ë°©ì…ë‹ˆë‹¤.");						
						} 
						else if(data.madeRoomByUser == true){
							alert("ì´ë¯¸ ë°© 1ê°œë¥¼ ë§Œë“œì…¨ìŠµë‹ˆë‹¤. í•œ Idë‹¹ ë°©ì€ 1ê°œë§Œ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.");
						}
						else if(data.existRoom == true){
							alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë°©ì´ ìˆìŠµë‹ˆë‹¤.")
						}
						else {
							alert("ë°©ì„ ë§Œë“¤ ìˆ˜ ì—†ì–´ìš”. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.")
						}
					}
					,error : function(){
						fail("ë°© ì¤‘ë³µí™•ì¸ ì—ëŸ¬");
						checkDuplicateId = true;
					}
				})
	   		})
   		}).then((arg) => {
   			let roomName = $("#roomName").val();
			let roomPw = $("#roomPw").val();
			
			if(roomName == ""){
				alert("ë°© ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”.");
				return;
			}
			if(roomPw == ""){
				alert("ë°© ë¹„ë°€ë²ˆí˜¸ë¥¼ ì ì–´ì£¼ì„¸ìš”.");
				return;
			}

			$.ajax({
				type:"post"
				,url : "/room/make"
				,data : {"roomName" : roomName, "roomPw" : roomPw}
				,success : function(data) {
					if(data.result == "success") {
						location.href="/leader/login-view"
					} else {
						console.log("ë°©ë§Œë“¤ê¸°ì‹¤íŒ¨")
					}
				}
				,error : function(){
					console.log("ë°©ë§Œë“¤ê¸° ë° ê°ì²´ì—…ë°ì´íŠ¸ ì—ëŸ¬");
				}
			});
   		})
	})
	</script>
</html>