<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{Layouts/default}">

	<header layout:fragment="header">
		<th:block th:replace="~{fragments/header :: .rightheader}"></th:block>
	</header>
	
	<section layout:fragment="content" class="mt-3">
		<div class="idInputDiv">
			<input type="text" class="idInput form-control" id="roomName" placeholder="ë°© ì´ë¦„">
		</div>
		<div class="pwInputDiv">
			<input type="password" class="pwInput form-control" id="roomPw" placeholder="ë°© ë¹„ë°€ë²ˆí˜¸ğŸ”‘">
		</div>
		<div class="pwInputDiv">
			<div data-toggle="modal" data-target="#BtnMakeRoom" class="BtnMakeRoom">ë°© ë§Œë“¤ê¸°</div>
		</div>
	</section>
	
	<div layout:fragment="modal">
		<div class="modal fade" id="BtnMakeRoom">
  		<div class="modal-dialog modal-dialog-centered">
  			<div class="modal-content">     		
     			<div class="modal-body">
     				<p>ê°™ì€ ë°© ì´ë¦„, ë¹„ë°€ë²ˆí˜¸ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p>
      				<p>ë³€ê²½í•´ì£¼ì„¸ìš”.</p>
      			</div>
      			<div>
      				<div data-dismiss="modal" class="closeBtn">Close</div>
      			</div>
    		</div>
 		 </div>
		</div>
	</div>
	
	<script layout:fragment="script">
		$(".BtnMakeRoom").on('click',function(){
			let roomName = $("#roomName").val();
			let roomPw = $("#roomPw").val();
			
			if(roomName == ""){
				alert("ë°© ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”.");
				return;
			}
			if(roomPw == ""){
				alert("ë°© ë¹„ë°€ë²ˆí˜¸ë¥¼ ì ì–´ì£¼ì„¸ìš”.");
				return;
			}
			
			new Promise((succ, fail) =>{
				$.ajax({
					type:"post"
					,url : "/room/make"
					,data : {"roomName" : roomName, "roomPw" : roomPw}
					,success : function(data) {
						if(data.result == "success") {
							succ(data);
							console.log(data);
						} else {
							succ(data);
							console.log(data);
						}
					}
					,error : function(){
						fail(error);
						console.log("promiese ì—ëŸ¬")
					}
				});
			}).then((arg) => {
				$.ajax({
					type:"post"
					,url:"/user/join/update"
					,data:{"roomName" : roomName, "roomPassword" : roomPw}
					,success:function(data){
						if(data.result == "success"){
							location.href="/leader/all-detail-view";
							alert("íŒ€ì¥ ê°ì²´ ì—…ë°ì´íŠ¸ ì„±ê³µ!");
						} else {
							alert("íŒ€ì¥ ê°ì²´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨!");
						}
					}
					,error : function(){
						alert("íŒ€ì¥ ê°ì²´ ì—…ë°ì´íŠ¸ ì—ëŸ¬!");
					}
				})
			})
		})
	</script>
</html>